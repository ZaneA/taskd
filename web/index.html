<!doctype html>
<html>
    <head>
        <title>taskd</title>
    </head>
    <body>
        <h1>taskd</h1>

        <div id="app"></div>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script type="text/jsx">
            // State
            var app = {
                variables: [],
                profiles: [],
                tasks: []
            };

            var VariableList = React.createClass({
                getInitialState: function () {
                    return app;
                },
                updateVariables: function () {
                    $.getJSON("/variables", function (data) {
                        app.variables = data.variables;
                        this.setState(app);
                    }.bind(this));
                },
                componentDidMount: function () {
                    this.timer = setInterval(this.updateVariables, 1000);
                },
                componentWillUnmount: function () {
                    clearInterval(this.timer);
                },
                render: function() {
                    return (
                        <table className="VariablesList">
                            <tr><td>Key</td><td>Value</td></tr>
                            {this.state.variables.map(function (variable) {
                                return (
                                    <tr><td>{variable.key}</td><td>{variable['value']}</td></tr>
                                )
                            })}
                        </table>
                    );
                }
            });

            // Boot React
            React.render(
                <VariableList app={app}/>,
                document.getElementById("app")
            );
        </script>
    </body>
</html>
